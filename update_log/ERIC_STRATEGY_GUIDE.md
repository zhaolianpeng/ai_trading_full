# Eric 全面策略指标使用指南

## 📊 概述

Eric 全面策略是一套综合性的技术分析指标体系，参考了 TradingView 上的专业策略。该策略结合了多个技术指标，提供更全面的市场分析。

## 🎯 核心指标

### 1. Eric Score（超买超卖指标）

**原理**：
- 计算价格在区间内的相对位置（0-1）
- 通过双重平滑和标准化，生成类似 Z-score 的指标
- 正值表示超买，负值表示超卖

**参数**：
- `eric_len`: 区间周期（默认14）
- `eric_zlen`: 标准化周期（默认20）
- `eric_smooth1`: 第一层平滑（默认3）
- `eric_smooth2`: 第二层平滑（默认5）
- `ob_lev`: 超买阈值（默认0.7）
- `os_lev`: 超卖阈值（默认-0.7）

**输出列**：
- `eric_score`: 原始 Eric Score
- `eric_score_smoothed`: 平滑后的 Eric Score
- `eric_oversold`: 一级超卖
- `eric_overbought`: 一级超买
- `eric_oversold2`: 二级超卖
- `eric_overbought2`: 二级超买

### 2. Donchian 通道（趋势过滤器）

**原理**：
- 使用 Donchian 通道（最高价/最低价的滚动窗口）判断趋势
- 通过通道边沿的抬升/下降判断趋势方向
- 结合价格与通道中轨的关系

**参数**：
- `chan_len`: 通道周期（默认55）
- `chan_tol`: 接近通道上下沿的容差（默认0.15，即15%）

**输出列**：
- `donchian_high`: 通道上沿
- `donchian_low`: 通道下沿
- `donchian_mid`: 通道中轨
- `near_upper`: 是否接近上沿
- `near_lower`: 是否接近下沿
- `channel_trend`: 通道趋势（'bullish', 'bearish', 'sideways'）

### 3. EMA 眼（支撑/压力提示）

**原理**：
- 计算价格与各条 EMA 的相对距离
- 小眼（<1%）：价格接近 EMA，可能形成支撑/压力
- 大眼（>3%）：价格远离 EMA

**参数**：
- `eye_small`: 小眼阈值（默认0.01，即1%）
- `eye_big`: 大眼阈值（默认0.03，即3%）

**输出列**：
- `eye21`, `eye55`, `eye100`, `eye200`: 眼的状态（0=正常, 1=小眼, 2=大眼）
- `eye21_support`, `eye21_pressure`: EMA21 支撑/压力
- `eye55_support`, `eye55_pressure`: EMA55 支撑/压力

### 4. 量能爆发检测

**原理**：
- 计算成交量相对于其移动平均的倍数
- 一级爆量：vol/sma > 1.8
- 二级爆量：vol/sma > 3.0

**参数**：
- `vol_len`: 量能基准周期（默认20）
- `vol_threshold1`: 一级爆量阈值（默认1.8）
- `vol_threshold2`: 二级爆量阈值（默认3.0）

**输出列**：
- `vol_ratio`: 成交量比率
- `vol_spike1`: 一级爆量
- `vol_spike2`: 二级爆量

### 5. 背离检测（价格 vs Eric Score）

**原理**：
- 牛背离：价格创新低，但 Eric Score 更高（看涨信号）
- 空背离：价格创新高，但 Eric Score 更低（看跌信号）

**参数**：
- `div_lookback`: 背离回溯周期（默认10）

**输出列**：
- `bull_divergence`: 牛背离
- `bear_divergence`: 空背离
- `divergence_strength`: 背离强度

### 6. 波动预警（ATR）

**原理**：
- 当 ATR 相对于其移动平均超过阈值时，发出波动预警
- 高波动可能意味着趋势转折或加速

**参数**：
- `atr_mult`: 波动预警阈值倍数（默认2.5）

**输出列**：
- `atr_sma`: ATR 的移动平均
- `volatility_warning`: 波动预警标志

## 🚀 使用方法

### 启用 Eric 指标

```bash
# 方式1: 环境变量
export USE_ERIC_INDICATORS=True
python3 main.py

# 方式2: .env 文件
USE_ERIC_INDICATORS=True
```

### 信号类型

启用 Eric 指标后，系统会检测以下信号：

1. **eric_long** - Eric 策略做多信号
   - 条件：Eric 超卖 + 接近通道下沿 + EMA 支撑 + 偏右确认
   - 评分：3-6 分（根据二级超卖、背离、爆量等加分）

2. **eric_short** - Eric 策略做空信号
   - 条件：Eric 超买 + 接近通道上沿 + EMA 压力 + 偏右确认
   - 评分：3-6 分（根据二级超买、背离、爆量等加分）

### 信号评分规则

**基础分数**：3 分

**加分项**：
- 二级超买/超卖：+1 分
- 背离确认：+1 分
- 二级爆量：+1 分

**置信度**：
- 分数 >= 5：高置信度
- 分数 < 5：中等置信度

## ⚙️ 配置参数

可以在代码中或通过配置文件调整以下参数：

```python
# Eric Score 参数
eric_len = 14          # 区间周期
eric_zlen = 20         # 标准化周期
ob_lev = 0.7          # 超买阈值
os_lev = -0.7         # 超卖阈值

# Donchian 通道参数
chan_len = 55         # 通道周期
chan_tol = 0.15       # 接近容差

# EMA 眼参数
eye_small = 0.01      # 小眼阈值（1%）
eye_big = 0.03        # 大眼阈值（3%）

# 量能参数
vol_threshold1 = 1.8  # 一级爆量
vol_threshold2 = 3.0  # 二级爆量

# 背离参数
div_lookback = 10     # 背离回溯周期

# 波动预警参数
atr_mult = 2.5        # ATR 倍数阈值
```

## 📈 信号逻辑

### 做多信号条件

1. **基础条件**：
   - Eric 超卖（一级或二级）
   - 价格接近通道下沿（15%容差内）
   - 通道趋势非强空

2. **EMA 支撑条件**（满足其一）：
   - 价格 > EMA55
   - EMA21 > EMA55
   - EMA21 眼支撑（价格在 EMA21 上方且接近）
   - EMA55 小眼

3. **背离增强**：
   - 牛背离（价格新低但 score 更高）

4. **偏右确认**：
   - 在后续 3 根 K 线内出现大实体阳线

### 做空信号条件

1. **基础条件**：
   - Eric 超买（一级或二级）
   - 价格接近通道上沿（15%容差内）
   - 通道趋势非强多

2. **EMA 压力条件**（满足其一）：
   - 价格 < EMA55
   - EMA21 < EMA55
   - EMA21 眼压力（价格在 EMA21 下方且接近）
   - EMA55 小眼

3. **背离增强**：
   - 空背离（价格新高但 score 更低）

4. **偏右确认**：
   - 在后续 3 根 K 线内出现大实体阴线

## 🔍 与原有指标的关系

Eric 策略指标可以与原有指标结合使用：

- **兼容性**：Eric 指标不影响原有指标的计算
- **互补性**：Eric 指标提供额外的信号维度
- **选择性**：可以通过 `USE_ERIC_INDICATORS` 开关控制

## 📊 输出示例

启用 Eric 指标后，分析报告会包含：

```
## 信号统计
检测到的信号总数: 45

信号类型分布:
  - 多头结构: 2
  - MACD金叉: 16
  - Eric策略做多: 5
  - Eric策略做空: 3
  - 布林带反弹: 10
  ...
```

## 💡 最佳实践

1. **首次使用**：先用合成数据测试，确认指标计算正常
2. **参数调优**：根据不同的市场和时间周期调整参数
3. **组合使用**：Eric 指标 + 原有指标 + LLM 分析，获得更全面的判断
4. **回测验证**：使用历史数据验证信号质量

## 🎯 优势

- **全面性**：结合趋势、超买超卖、量能、背离等多个维度
- **精确性**：偏右确认机制减少假信号
- **灵活性**：可以单独使用或与其他指标组合
- **可配置**：所有参数都可以调整

## 📝 注意事项

1. **计算量**：Eric 指标会增加一些计算时间，但已优化
2. **数据要求**：需要足够的历史数据（建议至少 200 条）
3. **参数敏感**：不同市场可能需要调整参数
4. **背离检测**：计算较慢，已优化为只检查最近 200 个点

